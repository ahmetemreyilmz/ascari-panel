import React, { useState, useEffect, useCallback, useRef } from 'react';
import { 
  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, 
  LineChart, Line, AreaChart, Area 
} from 'recharts';
import { 
  LayoutDashboard, ShoppingCart, Users, DollarSign, Settings, 
  LogOut, RefreshCw, ChevronRight, TrendingUp, Package, FileText, Code,
  ArrowLeft, Printer, Download, CheckCircle, Clock, AlertCircle,
  Search, PackageSearch, Tag, Layers, Zap, Plus, Minus, Trash2, QrCode,
  UserPlus, Gift, Shield, User, Wrench, ClipboardList, PenTool, Filter, X,
  ArrowUpRight, ArrowDownLeft, CreditCard, History, Phone, Mail, MapPin,
  Calendar, Edit3, Save, Briefcase
} from 'lucide-react';

const MOCK_DATA = {
  salesStats: { totalRevenue: 1254300, dailyStoreRevenue: 14250, activeQuotations: 42, confirmedOrders: 156, newCustomers: 12, personalQuotes: 5 },
  monthlySales: [ { name: 'Oca', satis: 65000, hedef: 50000 }, { name: 'Şub', satis: 58000, hedef: 55000 }, { name: 'Mar', satis: 85000, hedef: 60000 }, { name: 'Nis', satis: 92000, hedef: 70000 }, { name: 'May', satis: 115000, hedef: 80000 }, { name: 'Haz', satis: 108000, hedef: 85000 } ],
  customers: [
    { id: 1, name: 'Ahmet Emre Yılmaz', email: 'ahmet.yilmaz@ornek.com', phone: '0555 123 45 67', type: 'individual', balance: -1200.00, address: 'Kayseri, Türkiye' },
    { id: 2, name: 'Tekno Market A.Ş.', email: 'satin@teknomarket.com', phone: '0212 333 44 55', type: 'company', balance: 45000.00, address: 'İstanbul, Levent' },
    { id: 3, name: 'Mehmet Demir', email: 'mehmet.d@gmail.com', phone: '0532 999 88 77', type: 'individual', balance: 0.00, address: 'Ankara, Çankaya' },
    { id: 4, name: 'Global Lojistik', email: 'finans@globallojistik.com', phone: '0216 444 55 66', type: 'company', balance: 12500.50, address: 'Kocaeli, Gebze' },
    { id: 5, name: 'Ayşe Yılmaz', email: 'ayse.y@hotmail.com', phone: '0542 111 22 33', type: 'individual', balance: -4500.00, address: 'İzmir, Karşıyaka' },
  ],
  orders: [
    { id: 'S00124', customer: 'Ayşe Yılmaz', date: '2023-12-25', amount: 4500.00, status: 'sale', statusLabel: 'Satış Siparişi', lines: [{ product: 'Ofis Sandalyesi Ergonomik', qty: 2, price: 2250.00, subtotal: 4500.00 }] },
    { id: 'S00123', customer: 'Tekno Market A.Ş.', date: '2023-12-24', amount: 12850.50, status: 'done', statusLabel: 'Kilitlendi', lines: [{ product: 'Laptop Standı', qty: 10, price: 850.00, subtotal: 8500.00 }, { product: 'Klavye', qty: 5, price: 870.10, subtotal: 4350.50 }] },
    { id: 'S00122', customer: 'Mehmet Demir', date: '2023-12-24', amount: 850.00, status: 'draft', statusLabel: 'Teklif', lines: [{ product: 'USB-C Hub', qty: 1, price: 850.00, subtotal: 850.00 }] },
    { id: 'S00121', customer: 'Global Lojistik', date: '2023-12-23', amount: 34200.00, status: 'sale', statusLabel: 'Satış Siparişi', lines: [{ product: 'Endüstriyel Raf', qty: 4, price: 8550.00, subtotal: 34200.00 }] },
    { id: 'S00125', customer: 'Ahmet Emre Yılmaz', date: '2023-12-20', amount: 12000.00, status: 'sale', statusLabel: 'Satış Siparişi', lines: [{ product: 'Yönetici Masası', qty: 1, price: 12000.00, subtotal: 12000.00 }] },
    { id: 'S00126', customer: 'Ahmet Emre Yılmaz', date: '2023-12-26', amount: 2450.00, status: 'draft', statusLabel: 'Teklif', lines: [{ product: 'Ofis Sandalyesi', qty: 1, price: 2450.00, subtotal: 2450.00 }] },
  ],
  invoices: [
    { id: 'INV/2023/0056', type: 'out_invoice', ref: 'S00123', partner: 'Tekno Market A.Ş.', date: '2023-12-25', amount: 15420.60, status: 'posted', payment_state: 'paid', lines: [{desc: 'Laptop Standı x10', sub: 8500}, {desc: 'Klavye x5', sub: 4350.5}, {desc: 'KDV %20', sub: 2570.1}] },
    { id: 'INV/2023/0055', type: 'out_invoice', ref: 'S00121', partner: 'Global Lojistik', date: '2023-12-24', amount: 41040.00, status: 'posted', payment_state: 'not_paid', lines: [{desc: 'Endüstriyel Raf x4', sub: 34200}, {desc: 'KDV %20', sub: 6840}] },
    { id: 'INV/2023/0054', type: 'out_invoice', ref: 'S00125', partner: 'Ahmet Emre Yılmaz', date: '2023-12-20', amount: 12000.00, status: 'posted', payment_state: 'not_paid', lines: [{desc: 'Yönetici Masası', sub: 10000}, {desc: 'KDV %20', sub: 2000}] },
    { id: 'BILL/2023/001', type: 'in_invoice', ref: 'PO0012', partner: 'Ofis Tedarikçisi Ltd.', date: '2023-12-20', amount: 5000.00, status: 'posted', payment_state: 'paid', lines: [{desc: 'Kırtasiye Malzemesi', sub: 5000}] },
    { id: 'BILL/2023/002', type: 'in_invoice', ref: 'PO0014', partner: 'Elektrik Dağıtım A.Ş.', date: '2023-12-28', amount: 1250.00, status: 'posted', payment_state: 'not_paid', lines: [{desc: 'Aralık Elektrik Faturası', sub: 1250}] },
  ],
  products: [
    { id: 1, name: 'Ergonomik Ofis Koltuğu - Siyah', default_code: 'FURN_001', list_price: 2450.00, cost_price: 1200.00, qty_available: 15, category: 'Ofis Mobilyası', dimensions: '60x60x120 cm', weight: '12 kg' },
    { id: 2, name: 'Yönetici Masası - Meşe', default_code: 'FURN_002', list_price: 5800.00, cost_price: 3500.00, qty_available: 4, category: 'Ofis Mobilyası', dimensions: '180x90x75 cm', weight: '45 kg' },
    { id: 3, name: 'Çelik Dosya Dolabı', default_code: 'FURN_003', list_price: 1200.00, cost_price: 750.00, qty_available: 22, category: 'Depolama', dimensions: '90x40x190 cm', weight: '30 kg' },
    { id: 4, name: 'Konferans Masası', default_code: 'FURN_004', list_price: 8500.00, cost_price: 5000.00, qty_available: 2, category: 'Toplantı', dimensions: '240x110x75 cm', weight: '60 kg' },
    { id: 6, name: 'LED Masa Lambası', default_code: 'ACC_001', list_price: 450.00, cost_price: 150.00, qty_available: 50, category: 'Aksesuar', dimensions: '15x15x40 cm', weight: '0.8 kg' },
  ],
  categories: ['Tümü', 'Ofis Mobilyası', 'Depolama', 'Toplantı', 'Aksesuar'],
  tickets: [
    { id: 'SRV-2023-001', customer: 'Mehmet Demir', product: 'Ergonomik Ofis Koltuğu', issue: 'Amortisör çalışmıyor', status: 'progress', priority: 'high', date: '2023-12-24', notes: 'Parça bekleniyor.' },
    { id: 'SRV-2023-004', customer: 'Ahmet Emre Yılmaz', product: 'Yönetici Masası', issue: 'Kurulum sırasında çizik oluştu', status: 'new', priority: 'medium', date: '2023-12-26', notes: 'Müşteri aranacak.' },
  ]
};

const formatCurrency = (value) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(value);

const StatusBadge = ({ status, label, onClick }) => {
  const colors = { draft: 'bg-blue-100 text-blue-800 border-blue-200', sale: 'bg-green-100 text-green-800 border-green-200', done: 'bg-gray-100 text-gray-800 border-gray-200', cancel: 'bg-red-100 text-red-800 border-red-200', posted: 'bg-indigo-100 text-indigo-800 border-indigo-200', new: 'bg-blue-100 text-blue-800 border-blue-200', progress: 'bg-orange-100 text-orange-800 border-orange-200', solved: 'bg-green-100 text-green-800 border-green-200' };
  const labels = { new: 'Yeni', progress: 'İşlemde', solved: 'Çözüldü', sale: 'Satış Siparişi', draft: 'Teklif', done: 'Tamamlandı' };
  return <span onClick={onClick} className={`px-2.5 py-0.5 rounded-full text-xs font-medium border ${colors[status] || colors.draft} ${onClick ? 'cursor-pointer hover:opacity-80' : ''}`}>{label || labels[status] || status}</span>;
};

const PaymentBadge = ({ state }) => {
  if (state === 'paid') return <span className="flex items-center text-green-600 text-xs font-bold"><CheckCircle className="w-3 h-3 mr-1"/> Ödendi</span>;
  return <span className="flex items-center text-red-500 text-xs font-bold"><AlertCircle className="w-3 h-3 mr-1"/> Ödenmedi</span>;
}

export default function AscariDashboard() {
  const [data, setData] = useState(MOCK_DATA); 
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isConnected, setIsConnected] = useState(false);
  const [loading, setLoading] = useState(false);
  const [userRole, setUserRole] = useState('admin');
  const [logoError, setLogoError] = useState(false);
  const [credentials, setCredentials] = useState({ url: '', db: '', username: '', password: '' });

  // Filtreler ve Detaylar
  const [salesFilter, setSalesFilter] = useState('all');
  const [dateFilter, setDateFilter] = useState({ start: '', end: '' });
  const [customerBalanceFilter, setCustomerBalanceFilter] = useState('all');
  const [accountingSubTab, setAccountingSubTab] = useState('customer_invoices');
  const [invoiceSearch, setInvoiceSearch] = useState('');
  const [selectedOrder, setSelectedOrder] = useState(null);
  const [selectedCustomer, setSelectedCustomer] = useState(null);
  const [customerDetailTab, setCustomerDetailTab] = useState('orders');
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [selectedTicket, setSelectedTicket] = useState(null);
  const [selectedInvoice, setSelectedInvoice] = useState(null);
  
  // Hızlı Teklif
  const [searchTerm, setSearchTerm] = useState('');
  const [quickCart, setQuickCart] = useState([]);
  const [quickOfferDetails, setQuickOfferDetails] = useState(null);
  const [selectedCategory, setSelectedCategory] = useState('Tümü');
  const [tempCustomerName, setTempCustomerName] = useState('');
  const [tempCustomerPhone, setTempCustomerPhone] = useState('');
  const [showNewTicketForm, setShowNewTicketForm] = useState(false);
  const [newTicketData, setNewTicketData] = useState({ customer: '', product: '', issue: '', priority: 'medium' });
  const [isEditingProduct, setIsEditingProduct] = useState(false);

  const getMenuItems = () => {
    const allItems = [ { id: 'dashboard', name: 'Dashboard', icon: LayoutDashboard, roles: ['admin', 'sales'] }, { id: 'quick_offer', name: 'Hızlı Teklif', icon: Zap, roles: ['admin', 'sales'] }, { id: 'helpdesk', name: 'Teknik Servis', icon: Wrench, roles: ['admin', 'sales'] }, { id: 'sales', name: 'Satışlar', icon: ShoppingCart, roles: ['admin'] }, { id: 'products', name: 'Ürünler', icon: Package, roles: ['admin', 'sales'] }, { id: 'customers', name: 'Müşteriler', icon: Users, roles: ['admin'] }, { id: 'accounting', name: 'Muhasebe', icon: DollarSign, roles: ['admin'] }, { id: 'code', name: 'Entegrasyon Kodu', icon: Code, roles: ['admin'] } ];
    return allItems.filter(item => item.roles.includes(userRole));
  };

  const handleConnect = (e) => { e.preventDefault(); setLoading(true); setTimeout(() => { setLoading(false); setIsConnected(true); if(userRole === 'sales') setActiveTab('quick_offer'); }, 1000); };
  const handleLogout = () => { setIsConnected(false); setActiveTab('dashboard'); setUserRole('admin'); setSelectedCustomer(null); setSelectedOrder(null); setSelectedProduct(null); setSelectedTicket(null); setSelectedInvoice(null); setQuickCart([]); setQuickOfferDetails(null); };
  const addToQuickCart = useCallback((product) => { setQuickCart(prev => { const existing = prev.find(item => item.id === product.id); if (existing) return prev.map(item => item.id === product.id ? { ...item, qty: item.qty + 1 } : item); return [...prev, { ...product, qty: 1 }]; }); }, []);
  const removeFromQuickCart = (productId) => setQuickCart(prev => prev.filter(item => item.id !== productId));
  const updateCartQty = (productId, change) => setQuickCart(prev => prev.map(item => item.id === productId ? { ...item, qty: Math.max(1, item.qty + change) } : item));
  const createQuickOffer = () => { const total = quickCart.reduce((sum, item) => sum + (item.list_price * item.qty), 0); setQuickOfferDetails({ code: 'ASC-' + Math.floor(1000 + Math.random() * 9000), customer: tempCustomerName || 'Sayın Ziyaretçi', phone: tempCustomerPhone || '', date: new Date().toLocaleDateString('tr-TR'), items: [...quickCart], total: total, tax: total * 0.20, grandTotal: total * 1.20 }); };
  const handlePrint = () => { window.print(); window.location.reload(); };
  const handleTicketSubmit = (e) => { e.preventDefault(); const newTicket = { id: `SRV-2023-00${data.tickets.length + 1}`, ...newTicketData, status: 'new', date: new Date().toISOString().split('T')[0], notes: '' }; setData(prev => ({ ...prev, tickets: [newTicket, ...prev.tickets] })); setShowNewTicketForm(false); setNewTicketData({ customer: '', product: '', issue: '', priority: 'medium' }); };
  const isWithinDateRange = (dateStr) => { if (!dateFilter.start && !dateFilter.end) return true; const date = new Date(dateStr); const start = dateFilter.start ? new Date(dateFilter.start) : new Date('2000-01-01'); const end = dateFilter.end ? new Date(dateFilter.end) : new Date('2099-12-31'); return date >= start && date <= end; };

  const renderCustomers = () => {
    if (selectedCustomer) {
      const cOrders = data.orders.filter(o => o.customer === selectedCustomer.name);
      const cInvoices = data.invoices.filter(i => i.partner === selectedCustomer.name && i.type === 'out_invoice');
      const cTickets = data.tickets.filter(t => t.customer === selectedCustomer.name);
      return (
        <div className="space-y-6 animate-fadeIn">
          <div className="flex items-center"><button onClick={() => setSelectedCustomer(null)} className="mr-3 p-2 rounded-full hover:bg-slate-100 text-slate-500"><ArrowLeft className="w-5 h-5" /></button><div><h2 className="text-xl font-bold text-slate-900">{selectedCustomer.name}</h2><p className="text-xs text-slate-500">Müşteri Kartı</p></div></div>
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
             <div className="lg:col-span-1 space-y-6">
                <div className="bg-white shadow rounded-lg overflow-hidden border-t-4 border-indigo-500"><div className="p-6 text-center border-b border-slate-100"><div className="mx-auto h-24 w-24 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 text-3xl font-bold mb-4">{selectedCustomer.name.charAt(0)}</div><h3 className="text-lg font-bold text-slate-900">{selectedCustomer.name}</h3><span className={`inline-flex mt-2 px-2.5 py-0.5 rounded-full text-xs font-medium ${selectedCustomer.type === 'company' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}`}>{selectedCustomer.type === 'company' ? 'Kurumsal' : 'Bireysel'}</span></div><div className="px-6 py-4 bg-slate-50"><div className="flex justify-between items-center mb-2"><span className="text-sm text-slate-500">Bakiye Durumu</span></div><div className={`text-2xl font-bold ${selectedCustomer.balance < 0 ? 'text-red-600' : 'text-green-600'}`}>{formatCurrency(selectedCustomer.balance)}</div><p className="text-xs text-slate-400 mt-1">{selectedCustomer.balance < 0 ? 'Ödeme Bekleniyor' : 'Güvenli'}</p></div><div className="p-6 space-y-3"><div className="flex items-center text-sm text-slate-600"><Mail className="w-4 h-4 mr-3 text-slate-400"/> {selectedCustomer.email}</div><div className="flex items-center text-sm text-slate-600"><Phone className="w-4 h-4 mr-3 text-slate-400"/> {selectedCustomer.phone}</div><div className="flex items-center text-sm text-slate-600"><MapPin className="w-4 h-4 mr-3 text-slate-400"/> {selectedCustomer.address}</div></div></div>
             </div>
             <div className="lg:col-span-2">
                <div className="bg-white shadow rounded-lg overflow-hidden min-h-[500px]">
                   <div className="border-b border-slate-200"><nav className="flex -mb-px"><button onClick={() => setCustomerDetailTab('orders')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${customerDetailTab === 'orders' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><ShoppingCart className="w-4 h-4 inline-block mr-2 mb-0.5"/> Siparişler ({cOrders.length})</button><button onClick={() => setCustomerDetailTab('invoices')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${customerDetailTab === 'invoices' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><CreditCard className="w-4 h-4 inline-block mr-2 mb-0.5"/> Faturalar ({cInvoices.length})</button><button onClick={() => setCustomerDetailTab('tickets')} className={`w-1/3 py-4 px-1 text-center border-b-2 font-medium text-sm ${customerDetailTab === 'tickets' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-slate-500 hover:text-slate-700'}`}><Wrench className="w-4 h-4 inline-block mr-2 mb-0.5"/> Servis ({cTickets.length})</button></nav></div>
                   <div className="p-4">
                      {customerDetailTab === 'orders' && (cOrders.length > 0 ? cOrders.map(o => <div key={o.id} className="border border-slate-200 rounded-lg p-4 mb-3 hover:bg-slate-50 flex justify-between items-center"><div><div className="flex items-center space-x-2"><span className="font-bold text-indigo-600">{o.id}</span><span className="text-xs text-slate-400">• {o.date}</span></div><div className="text-sm text-slate-600 mt-1">{o.lines.map(l => l.product).join(', ')}</div></div><div className="text-right"><div className="font-bold text-slate-800">{formatCurrency(o.amount)}</div><StatusBadge status={o.status} label={o.statusLabel} /></div></div>) : <div className="text-center py-10 text-slate-400">Kayıt yok.</div>)}
                      {customerDetailTab === 'invoices' && (cInvoices.length > 0 ? cInvoices.map(i => <div key={i.id} className="border border-slate-200 rounded-lg p-4 mb-3 hover:bg-slate-50 flex justify-between items-center"><div><div className="font-bold text-slate-700">{i.id}</div><div className="text-xs text-slate-500">Ref: {i.ref} • {i.date}</div></div><div className="text-right"><div className="font-bold text-slate-900">{formatCurrency(i.amount)}</div><PaymentBadge state={i.payment_state} /></div></div>) : <div className="text-center py-10 text-slate-400">Kayıt yok.</div>)}
                      {customerDetailTab === 'tickets' && (cTickets.length > 0 ? cTickets.map(t => <div key={t.id} className="border border-slate-200 rounded-lg p-4 mb-3 hover:bg-slate-50"><div className="flex justify-between mb-2"><span className="font-bold text-slate-800">{t.product}</span><StatusBadge status={t.status} /></div><p className="text-sm text-slate-600">{t.issue}</p><div className="mt-2 text-xs text-slate-400 flex justify-between"><span>Kayıt: {t.id}</span><span>{t.date}</span></div></div>) : <div className="text-center py-10 text-slate-400">Kayıt yok.</div>)}
                   </div>
                </div>
             </div>
          </div>
        </div>
      );
    }
    const filteredCustomers = data.customers.filter(c => customerBalanceFilter === 'all' ? true : customerBalanceFilter === 'debtor' ? c.balance < 0 : c.balance > 0);
    return (<div className="space-y-6 animate-fadeIn"><div className="flex justify-between items-center bg-white p-4 rounded-lg shadow-sm"><h3 className="text-lg font-medium text-slate-900">Müşteri Listesi</h3><div className="flex space-x-2"><button onClick={()=>setCustomerBalanceFilter('all')} className={`px-3 py-1 text-xs rounded-full ${customerBalanceFilter === 'all' ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100'}`}>Tümü</button><button onClick={()=>setCustomerBalanceFilter('debtor')} className={`px-3 py-1 text-xs rounded-full ${customerBalanceFilter === 'debtor' ? 'bg-red-100 text-red-700' : 'bg-slate-100'}`}>Borçlular</button><button onClick={()=>setCustomerBalanceFilter('creditor')} className={`px-3 py-1 text-xs rounded-full ${customerBalanceFilter === 'creditor' ? 'bg-green-100 text-green-700' : 'bg-slate-100'}`}>Alacaklılar</button></div></div><div className="bg-white shadow sm:rounded-lg overflow-hidden"><ul className="divide-y divide-slate-200">{filteredCustomers.map((customer) => (<li key={customer.id} onClick={() => setSelectedCustomer(customer)} className="hover:bg-indigo-50 cursor-pointer transition-colors px-4 py-4 flex justify-between items-center"><div className="flex items-center"><div className="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold mr-4">{customer.name.charAt(0)}</div><div><p className="text-sm font-medium text-indigo-600">{customer.name}</p><p className="text-xs text-slate-500">{customer.phone}</p></div></div><div className={`text-sm font-bold ${customer.balance < 0 ? 'text-red-600' : 'text-green-600'}`}>{formatCurrency(customer.balance)}</div></li>))}</ul></div></div>);
  };

  const renderProducts = () => { if (selectedProduct) { return (<div className="space-y-6 animate-fadeIn"><div className="flex justify-between items-center"><button onClick={() => {setSelectedProduct(null); setIsEditingProduct(false);}} className="flex items-center text-slate-500 hover:text-slate-900"><ArrowLeft className="w-5 h-5 mr-2" /> Ürünlere Dön</button><button onClick={() => setIsEditingProduct(!isEditingProduct)} className={`flex items-center px-4 py-2 rounded-md font-medium text-sm ${isEditingProduct ? 'bg-green-600 text-white' : 'bg-indigo-600 text-white'}`}>{isEditingProduct ? <><Save className="w-4 h-4 mr-2"/> Kaydet</> : <><Edit3 className="w-4 h-4 mr-2"/> Düzenle</>}</button></div><div className="bg-white shadow rounded-lg p-8 flex flex-col md:flex-row gap-8"><div className="w-full md:w-1/3 flex items-center justify-center bg-slate-50 rounded-lg h-64 border border-slate-200"><PackageSearch className="w-24 h-24 text-slate-300" /></div><div className="w-full md:w-2/3 space-y-6"><div><label className="text-xs font-bold text-slate-400 uppercase">Ürün Adı</label>{isEditingProduct ? <input className="w-full border p-2 rounded mt-1" defaultValue={selectedProduct.name} /> : <h2 className="text-2xl font-bold text-slate-900">{selectedProduct.name}</h2>}</div><div className="grid grid-cols-2 gap-4"><div><label className="text-xs font-bold text-slate-400 uppercase">Kod</label><p className="font-mono text-slate-700">{selectedProduct.default_code}</p></div><div><label className="text-xs font-bold text-slate-400 uppercase">Kategori</label><p className="text-slate-700">{selectedProduct.category}</p></div><div><label className="text-xs font-bold text-slate-400 uppercase">Satış Fiyatı</label>{isEditingProduct ? <input className="border p-1 rounded w-full" defaultValue={selectedProduct.list_price}/> : <p className="text-xl font-bold text-indigo-600">{formatCurrency(selectedProduct.list_price)}</p>}</div><div><label className="text-xs font-bold text-slate-400 uppercase">Maliyet</label>{isEditingProduct ? <input className="border p-1 rounded w-full" defaultValue={selectedProduct.cost_price}/> : <p className="text-xl font-bold text-slate-500">{formatCurrency(selectedProduct.cost_price)}</p>}</div><div><label className="text-xs font-bold text-slate-400 uppercase">Ölçüler</label><p className="text-slate-700">{selectedProduct.dimensions || '-'}</p></div><div><label className="text-xs font-bold text-slate-400 uppercase">Ağırlık</label><p className="text-slate-700">{selectedProduct.weight || '-'}</p></div><div className="col-span-2 bg-slate-50 p-4 rounded border border-slate-200"><label className="text-xs font-bold text-slate-400 uppercase">Stok Durumu</label><p className={`text-lg font-bold ${selectedProduct.qty_available > 0 ? 'text-green-600' : 'text-red-600'}`}>{selectedProduct.qty_available} Adet Mevcut</p></div></div></div></div></div>) } const filteredProducts = data.products.filter(product => product.name.toLowerCase().includes(searchTerm.toLowerCase())); return <div className="space-y-6 animate-fadeIn"><div className="bg-white shadow sm:rounded-lg p-4"><input type="text" className="block w-full pl-3 sm:text-sm border-slate-300 rounded-md py-3 border" placeholder="Ürün Ara..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /></div><div className="grid grid-cols-1 gap-6 sm:grid-cols-4">{filteredProducts.map(p => <div key={p.id} onClick={() => setSelectedProduct(p)} className="bg-white shadow rounded-lg p-5 flex flex-col justify-between h-48 border border-slate-100 cursor-pointer hover:border-indigo-500 transition-colors"><h3 className="font-bold text-slate-800">{p.name}</h3><div><p className="text-xs text-slate-400 mb-1">{p.default_code}</p><span className="text-indigo-600 font-bold text-lg">{formatCurrency(p.list_price)}</span></div></div>)}</div></div>; };
  const renderSales = () => { const filteredOrders = data.orders.filter(order => { const typeMatch = salesFilter === 'all' ? true : salesFilter === 'orders' ? ['sale', 'done'].includes(order.status) : order.status === 'draft'; return typeMatch && isWithinDateRange(order.date); }); if (selectedOrder) { return (<div className="space-y-6 animate-fadeIn"><button onClick={() => setSelectedOrder(null)} className="flex items-center text-slate-500 hover:text-slate-900 mb-4"><ArrowLeft className="w-5 h-5 mr-2" /> Listeye Dön</button><div className="bg-white shadow overflow-hidden sm:rounded-lg"><div className="px-4 py-5 sm:px-6 flex justify-between"><div><h3 className="text-lg font-bold">{selectedOrder.id}</h3><p className="text-sm text-slate-500">{selectedOrder.date}</p></div><StatusBadge status={selectedOrder.status} label={selectedOrder.statusLabel} /></div><div className="border-t border-slate-200 px-4 py-5 sm:px-6"><h4 className="font-medium mb-2">Müşteri: {selectedOrder.customer}</h4><table className="min-w-full divide-y divide-slate-200"><thead className="bg-slate-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-slate-500">Ürün</th><th className="px-6 py-3 text-right text-xs font-medium text-slate-500">Tutar</th></tr></thead><tbody>{selectedOrder.lines.map((l, i)=><tr key={i}><td className="px-6 py-4 text-sm">{l.product} x {l.qty}</td><td className="px-6 py-4 text-right text-sm font-bold">{formatCurrency(l.subtotal)}</td></tr>)}</tbody></table></div></div></div>); } return (<div className="space-y-6 animate-fadeIn"><div className="bg-white p-4 rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0"><div className="flex space-x-2 bg-slate-100 p-1 rounded-lg">{['all', 'orders', 'quotations'].map(f => (<button key={f} onClick={() => setSalesFilter(f)} className={`px-4 py-1.5 text-sm font-medium rounded-md transition-all ${salesFilter === f ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>{f === 'all' ? 'Tümü' : f === 'orders' ? 'Siparişler' : 'Teklifler'}</button>))}</div><div className="flex items-center space-x-2 text-sm"><Calendar className="w-4 h-4 text-slate-400" /><input type="date" className="border border-slate-300 rounded px-2 py-1" onChange={e => setDateFilter({...dateFilter, start: e.target.value})} /><span className="text-slate-400">-</span><input type="date" className="border border-slate-300 rounded px-2 py-1" onChange={e => setDateFilter({...dateFilter, end: e.target.value})} /></div></div><div className="bg-white shadow overflow-hidden sm:rounded-lg"><ul className="divide-y divide-slate-200">{filteredOrders.length > 0 ? filteredOrders.map((order) => (<li key={order.id} onClick={() => setSelectedOrder(order)} className="px-4 py-4 sm:px-6 hover:bg-slate-50 transition-colors cursor-pointer"><div className="grid grid-cols-12 gap-4 items-center"><div className="col-span-2 font-medium text-indigo-600">{order.id}</div><div className="col-span-4 text-slate-900">{order.customer}</div><div className="col-span-2 text-slate-500">{order.date}</div><div className="col-span-2 text-slate-900 font-medium text-right">{formatCurrency(order.amount)}</div><div className="col-span-2 flex justify-center"><StatusBadge status={order.status} label={order.statusLabel} /></div></div></li>)) : <div className="p-8 text-center text-slate-500">Kayıt bulunamadı.</div>}</ul></div></div>); };
  const renderAccounting = () => { if (selectedInvoice) { return (<div className="space-y-6 animate-fadeIn"><button onClick={() => setSelectedInvoice(null)} className="flex items-center text-slate-500 hover:text-slate-900 mb-4"><ArrowLeft className="w-5 h-5 mr-2" /> Faturalara Dön</button><div className="bg-white shadow rounded-lg p-8 border border-slate-200 relative"><div className="absolute top-0 right-0 p-4"><PaymentBadge state={selectedInvoice.payment_state} /></div><h2 className="text-2xl font-bold text-slate-800 mb-1">{selectedInvoice.id}</h2><p className="text-slate-500 mb-6">{selectedInvoice.date}</p><div className="grid grid-cols-2 gap-8 mb-8"><div><h4 className="font-bold text-gray-500 text-xs uppercase">Muhatap</h4><p className="text-lg">{selectedInvoice.partner}</p></div><div className="text-right"><h4 className="font-bold text-gray-500 text-xs uppercase">Tutar</h4><p className="text-2xl font-bold text-indigo-600">{formatCurrency(selectedInvoice.amount)}</p></div></div><table className="w-full border-t border-slate-200"><thead className="bg-slate-50"><tr><th className="text-left py-2 text-sm text-slate-600">Açıklama</th><th className="text-right py-2 text-sm text-slate-600">Tutar</th></tr></thead><tbody>{selectedInvoice.lines?.map((line, i) => <tr key={i} className="border-b border-slate-100"><td className="py-2 text-slate-800">{line.desc}</td><td className="py-2 text-right font-medium">{formatCurrency(line.sub)}</td></tr>)}</tbody></table></div></div>) } const filteredInvoices = data.invoices.filter(inv => { const typeMatch = accountingSubTab === 'customer_invoices' ? inv.type === 'out_invoice' : inv.type === 'in_invoice'; const searchMatch = inv.partner.toLowerCase().includes(invoiceSearch.toLowerCase()) || inv.id.toLowerCase().includes(invoiceSearch.toLowerCase()); return typeMatch && searchMatch; }); return (<div className="space-y-6 animate-fadeIn"><div className="flex flex-col sm:flex-row justify-between items-center border-b border-slate-200 pb-4"><nav className="flex space-x-4 mb-4 sm:mb-0"><button onClick={() => setAccountingSubTab('customer_invoices')} className={`${accountingSubTab === 'customer_invoices' ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'} px-4 py-2 rounded-lg font-medium text-sm flex items-center`}><ArrowUpRight className="w-4 h-4 mr-2" /> Giden Faturalar</button><button onClick={() => setAccountingSubTab('vendor_bills')} className={`${accountingSubTab === 'vendor_bills' ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-600'} px-4 py-2 rounded-lg font-medium text-sm flex items-center`}><ArrowDownLeft className="w-4 h-4 mr-2" /> Gelen Faturalar</button></nav><div className="relative"><Search className="absolute left-3 top-2.5 h-4 w-4 text-slate-400"/><input type="text" placeholder="Fatura Ara..." className="pl-9 pr-4 py-2 border border-slate-300 rounded-md text-sm w-64" value={invoiceSearch} onChange={e=>setInvoiceSearch(e.target.value)}/></div></div><div className="bg-white shadow overflow-hidden sm:rounded-lg"><table className="min-w-full divide-y divide-slate-200"><thead className="bg-slate-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-slate-500">No</th><th className="px-6 py-3 text-left text-xs font-medium text-slate-500">{accountingSubTab === 'customer_invoices' ? 'Müşteri' : 'Tedarikçi'}</th><th className="px-6 py-3 text-left text-xs font-medium text-slate-500">Tarih</th><th className="px-6 py-3 text-right text-xs font-medium text-slate-500">Tutar</th><th className="px-6 py-3 text-center text-xs font-medium text-slate-500">Durum</th><th className="px-6 py-3 text-center text-xs font-medium text-slate-500">Ödeme</th></tr></thead><tbody className="bg-white divide-y divide-slate-200">{filteredInvoices.length > 0 ? filteredInvoices.map((inv) => (<tr key={inv.id} onClick={() => setSelectedInvoice(inv)} className="hover:bg-slate-50 cursor-pointer"><td className="px-6 py-4 text-sm font-medium text-indigo-600">{inv.id}</td><td className="px-6 py-4 text-sm text-slate-900">{inv.partner}</td><td className="px-6 py-4 text-sm text-slate-500">{inv.date}</td><td className="px-6 py-4 text-sm text-slate-900 font-bold text-right">{formatCurrency(inv.amount)}</td><td className="px-6 py-4 text-center"><StatusBadge status={inv.status} label={inv.status === 'posted' ? 'Onaylı' : 'Taslak'} /></td><td className="px-6 py-4 flex justify-center"><PaymentBadge state={inv.payment_state} /></td></tr>)) : <tr><td colSpan="6" className="px-6 py-8 text-center text-slate-500 text-sm">Fatura bulunamadı.</td></tr>}</tbody></table></div></div>); };
  const renderHelpdesk = () => { if (selectedTicket) { return (<div className="space-y-6 animate-fadeIn"><button onClick={() => setSelectedTicket(null)} className="flex items-center text-slate-500 hover:text-slate-900 mb-4"><ArrowLeft className="w-5 h-5 mr-2" /> Listeye Dön</button><div className="bg-white shadow rounded-lg p-6 border-l-4 border-indigo-500"><div className="flex justify-between items-start mb-6"><div><h2 className="text-xl font-bold text-slate-900">{selectedTicket.issue}</h2><p className="text-sm text-slate-500">Kayıt: {selectedTicket.id} • {selectedTicket.date}</p></div><div className="flex flex-col items-end gap-2"><select className="border border-slate-300 rounded-md text-sm p-1" value={selectedTicket.status} onChange={(e) => { const updated = {...selectedTicket, status: e.target.value}; setSelectedTicket(updated); }}><option value="new">Yeni</option><option value="progress">İşlemde</option><option value="solved">Çözüldü</option></select></div></div><div className="grid grid-cols-2 gap-6"><div className="bg-slate-50 p-4 rounded"><h4 className="font-bold text-xs uppercase text-slate-400 mb-2">Müşteri Bilgisi</h4><p className="font-medium text-slate-900">{selectedTicket.customer}</p></div><div className="bg-slate-50 p-4 rounded"><h4 className="font-bold text-xs uppercase text-slate-400 mb-2">İlgili Ürün</h4><p className="font-medium text-slate-900">{selectedTicket.product}</p></div><div className="col-span-2"><h4 className="font-bold text-xs uppercase text-slate-400 mb-2">Notlar</h4><textarea className="w-full border border-slate-300 rounded p-2 text-sm" rows="3" defaultValue={selectedTicket.notes}></textarea></div></div></div></div>) } return (<div className="space-y-6 animate-fadeIn"><div className="flex justify-between items-center"><h2 className="text-lg font-medium text-slate-900">Arıza Kayıtları</h2><button onClick={() => setShowNewTicketForm(true)} className="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm">Yeni Kayıt</button></div>{showNewTicketForm && <div className="bg-white p-6 shadow-lg rounded-lg border border-indigo-100"><div className="flex justify-between mb-4"><h3 className="font-bold">Yeni Kayıt</h3><button onClick={()=>setShowNewTicketForm(false)}><X className="w-5 h-5"/></button></div><form onSubmit={handleTicketSubmit} className="grid grid-cols-2 gap-4"><input placeholder="Müşteri" className="border p-2 rounded" required value={newTicketData.customer} onChange={e=>setNewTicketData({...newTicketData, customer:e.target.value})}/><input placeholder="Ürün" className="border p-2 rounded" required value={newTicketData.product} onChange={e=>setNewTicketData({...newTicketData, product:e.target.value})}/><textarea placeholder="Sorun" className="border p-2 rounded col-span-2" required value={newTicketData.issue} onChange={e=>setNewTicketData({...newTicketData, issue:e.target.value})}/><button type="submit" className="bg-indigo-600 text-white p-2 rounded col-span-2">Kaydet</button></form></div>}<div className="bg-white shadow overflow-hidden sm:rounded-lg"><ul className="divide-y divide-slate-200">{data.tickets.map(t=><li key={t.id} onClick={() => setSelectedTicket(t)} className="px-4 py-4 flex justify-between cursor-pointer hover:bg-slate-50"><div><div className="font-bold text-slate-800">{t.product}</div><div className="text-sm text-slate-500">{t.customer} - {t.issue}</div></div><StatusBadge status={t.status}/></li>)}</ul></div></div>); };
  const renderQuickOfferFull = () => { /* ... */ const filteredProducts = data.products.filter(product => { const matchesSearch = product.name.toLowerCase().includes(searchTerm.toLowerCase()) || product.default_code.toLowerCase().includes(searchTerm.toLowerCase()); const matchesCategory = selectedCategory === 'Tümü' || product.category === selectedCategory; return matchesSearch && matchesCategory; }); const cartTotal = quickCart.reduce((sum, item) => sum + (item.list_price * item.qty), 0); if (quickOfferDetails) { return (<div className="flex flex-col h-full animate-fadeIn"><div className="flex justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm border border-slate-200"><div className="flex items-center text-green-600"><CheckCircle className="w-6 h-6 mr-2" /><span className="font-bold text-lg">Teklif Hazır</span></div><div className="flex space-x-3"><button onClick={() => { setQuickOfferDetails(null); setQuickCart([]); setSearchTerm(''); setTempCustomerName(''); setTempCustomerPhone(''); }} className="flex items-center px-4 py-2 border border-slate-300 rounded-md text-slate-700 bg-white hover:bg-slate-50 text-sm font-medium"><Plus className="w-4 h-4 mr-2"/> Yeni</button><button onClick={handlePrint} className="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm font-medium shadow-sm"><Printer className="w-4 h-4 mr-2"/> Yazdır</button></div></div><div className="flex-1 overflow-y-auto bg-slate-100 p-8 flex justify-center"><div id="printable-offer" className="bg-white w-[210mm] min-h-[297mm] p-10 shadow-lg text-slate-900 relative"><div className="flex justify-between items-start mb-12 border-b-2 border-slate-100 pb-8"><div><div className="bg-slate-900 text-white font-bold text-2xl p-3 inline-block rounded mb-2">ASCARI</div><p className="text-sm text-slate-500">info@ascari.com.tr</p></div><div className="text-right"><h1 className="text-4xl font-light text-slate-300 mb-2">TEKLİF</h1><p className="font-bold text-lg text-indigo-600">#{quickOfferDetails.code}</p><p className="text-sm text-slate-500">{quickOfferDetails.date}</p></div></div><div className="mb-10"><h3 className="text-xs uppercase tracking-wider text-slate-400 font-bold mb-1">Sayın</h3><div className="text-xl font-semibold text-slate-800">{quickOfferDetails.customer}</div>{quickOfferDetails.phone && <div className="text-sm text-slate-500">{quickOfferDetails.phone}</div>}</div><table className="w-full mb-8"><thead><tr className="border-b border-slate-300"><th className="text-left py-3 text-sm font-bold text-slate-600">Ürün</th><th className="text-right py-3 text-sm font-bold text-slate-600">Miktar</th><th className="text-right py-3 text-sm font-bold text-slate-600">Fiyat</th><th className="text-right py-3 text-sm font-bold text-slate-600">Toplam</th></tr></thead><tbody>{quickOfferDetails.items.map((item, idx) => (<tr key={idx} className="border-b border-slate-100"><td className="py-4 text-sm text-slate-700">{item.name}</td><td className="py-4 text-right text-sm text-slate-700">{item.qty}</td><td className="py-4 text-right text-sm text-slate-700">{formatCurrency(item.list_price)}</td><td className="py-4 text-right text-sm font-medium text-slate-900">{formatCurrency(item.list_price * item.qty)}</td></tr>))}</tbody></table><div className="flex justify-end mb-16"><div className="w-64"><div className="flex justify-between py-4"><span className="text-lg font-bold text-slate-800">Genel Toplam</span><span className="text-lg font-bold text-indigo-600">{formatCurrency(quickOfferDetails.grandTotal)}</span></div></div></div></div></div></div>); } return (<div className="flex flex-col h-[calc(100vh-140px)] gap-4 animate-fadeIn"><div className="flex space-x-2 overflow-x-auto pb-2 scrollbar-hide">{data.categories.map(cat => (<button key={cat} onClick={() => setSelectedCategory(cat)} className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${selectedCategory === cat ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'}`}>{cat}</button>))}</div><div className="flex flex-1 gap-6 overflow-hidden"><div className="w-2/3 flex flex-col space-y-4"><div className="bg-white p-3 rounded-lg shadow-sm"><div className="relative"><div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><Search className="h-5 w-5 text-slate-400" /></div><input type="text" className="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-10 sm:text-sm border-slate-300 rounded-md py-2.5" placeholder="Ürün ara..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}/></div></div><div className="flex-1 overflow-y-auto bg-white rounded-lg shadow-sm p-4"><div className="grid grid-cols-2 lg:grid-cols-3 gap-4">{filteredProducts.map(product => (<div key={product.id} className="border border-slate-200 rounded-lg p-3 hover:border-indigo-300 transition-colors flex flex-col group cursor-pointer" onClick={() => addToQuickCart(product)}><div className="h-24 bg-slate-50 rounded mb-2 flex items-center justify-center group-hover:bg-indigo-50 transition-colors"><PackageSearch className="text-slate-300 w-8 h-8 group-hover:text-indigo-300" /></div><div className="flex-1"><h4 className="text-sm font-medium text-slate-900 truncate">{product.name}</h4><p className="text-xs text-slate-500 mb-2">{product.default_code}</p></div><div className="flex items-center justify-between mt-2"><span className="font-bold text-slate-900">{formatCurrency(product.list_price)}</span><div className="p-1.5 bg-indigo-50 text-indigo-600 rounded-full"><Plus className="w-4 h-4" /></div></div></div>))}</div></div></div><div className="w-1/3 flex flex-col bg-white rounded-lg shadow-lg border border-slate-200 h-full"><div className="p-4 border-b border-slate-100 bg-slate-50 rounded-t-lg"><h3 className="font-bold text-slate-800 flex items-center"><Zap className="w-4 h-4 text-orange-500 mr-2" fill="currentColor" />Hızlı Teklif Taslağı</h3></div><div className="flex-1 overflow-y-auto p-4 space-y-3">{quickCart.length === 0 ? (<div className="h-full flex flex-col items-center justify-center text-slate-400 text-sm"><Package className="w-12 h-12 mb-2 opacity-20" /><p>Ürün seçilmedi</p></div>) : (quickCart.map(item => (<div key={item.id} className="flex items-start justify-between bg-slate-50 p-3 rounded-md"><div className="flex-1 pr-2"><div className="text-sm font-medium text-slate-900 line-clamp-2">{item.name}</div><div className="text-xs text-slate-500 mt-1">{formatCurrency(item.list_price)} x {item.qty}</div></div><div className="flex flex-col items-end space-y-2"><div className="font-bold text-slate-900 text-sm">{formatCurrency(item.list_price * item.qty)}</div><div className="flex items-center bg-white rounded border border-slate-200"><button onClick={() => updateCartQty(item.id, -1)} className="p-1 hover:bg-slate-100 text-slate-600"><Minus className="w-3 h-3"/></button><span className="px-2 text-xs font-medium">{item.qty}</span><button onClick={() => addToQuickCart(item)} className="p-1 hover:bg-slate-100 text-slate-600"><Plus className="w-3 h-3"/></button></div></div><button onClick={() => removeFromQuickCart(item.id)} className="ml-2 text-red-400 hover:text-red-600"><Trash2 className="w-4 h-4" /></button></div>)))}</div><div className="p-4 border-t border-slate-100 bg-slate-50 rounded-b-lg space-y-3"><div className="flex justify-between items-center mb-2"><span className="text-slate-600 font-medium">Toplam Tutar</span><span className="text-xl font-bold text-slate-900">{formatCurrency(cartTotal)}</span></div><div className="grid grid-cols-2 gap-2"><input type="text" placeholder="Müşteri Adı" value={tempCustomerName} onChange={(e) => setTempCustomerName(e.target.value)} className="w-full border-slate-300 rounded-md shadow-sm text-sm p-2 border"/><input type="tel" placeholder="Telefon" value={tempCustomerPhone} onChange={(e) => setTempCustomerPhone(e.target.value)} className="w-full border-slate-300 rounded-md shadow-sm text-sm p-2 border"/></div><button onClick={createQuickOffer} disabled={quickCart.length === 0} className={`w-full py-3 rounded-lg font-bold text-white shadow-lg transition-all transform active:scale-95 ${quickCart.length === 0 ? 'bg-slate-300 cursor-not-allowed' : 'bg-slate-900 hover:bg-slate-800'}`}>Teklif Oluştur</button></div></div></div></div>); };

  if (!isConnected) {
    return (
      <div className="min-h-screen bg-slate-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
        <div className="sm:mx-auto sm:w-full sm:max-w-md text-center">
          <div className="mx-auto h-24 w-auto flex items-center justify-center mb-6 bg-slate-900 rounded-lg shadow-lg p-4 max-w-[200px]">{!logoError ? <img src="Ascari Beyaz Logo.png" alt="Ascari Logo" className="h-full object-contain" onError={() => setLogoError(true)} /> : <span className="text-white font-bold text-2xl">ASCARI</span>}</div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-slate-900">Odoo Yönetim Paneli</h2>
        </div>
        <div className="mt-8 sm:mx-auto sm:w-full sm:max-w-md"><div className="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10 border border-slate-200"><form className="space-y-6" onSubmit={handleConnect}><div><label className="block text-sm font-medium text-slate-700">Odoo URL</label><input type="text" className="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="https://sirketiniz.odoo.com" value={credentials.url} onChange={e => setCredentials({...credentials, url: e.target.value})} /></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium text-slate-700">Veritabanı</label><input type="text" className="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="db_name" value={credentials.db} onChange={e => setCredentials({...credentials, db: e.target.value})} /></div><div><label className="block text-sm font-medium text-slate-700">Giriş Yetkisi</label><select value={userRole} onChange={(e) => setUserRole(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"><option value="admin">Yönetici / Admin</option><option value="sales">Satış Personeli (Mağaza)</option></select></div></div><div><label className="block text-sm font-medium text-slate-700">E-Posta / Kullanıcı</label><input type="text" className="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value={credentials.username} onChange={e => setCredentials({...credentials, username: e.target.value})} /></div><div><label className="block text-sm font-medium text-slate-700">Şifre</label><input type="password" className="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value={credentials.password} onChange={e => setCredentials({...credentials, password: e.target.value})} /></div><button type="submit" disabled={loading} className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-slate-900 hover:bg-slate-800 transition-colors">{loading ? <span className="flex items-center"><RefreshCw className="animate-spin -ml-1 mr-2 h-4 w-4" /> Bağlanıyor...</span> : 'Bağlantı Kur'}</button></form></div></div>
      </div>
    );
  }

  return (
    <div className="flex h-screen bg-slate-50 overflow-hidden font-sans">
      <div className="hidden md:flex md:flex-shrink-0"><div className="flex flex-col w-64"><div className="flex flex-col h-0 flex-1 bg-slate-900"><div className="flex-1 flex flex-col pt-5 pb-4 overflow-y-auto"><div className="flex items-center flex-shrink-0 px-4 mb-8 h-10">{!logoError ? <img src="Ascari Beyaz Logo.png" alt="Ascari" className="h-10 w-auto" onError={() => setLogoError(true)} /> : <span className="text-white font-bold text-2xl">ASCARI</span>}</div><div className="px-4 mb-6 flex items-center"><div className="bg-slate-800 p-2 rounded-full mr-3">{userRole === 'admin' ? <Shield className="text-yellow-400 w-5 h-5"/> : <User className="text-indigo-400 w-5 h-5"/>}</div><div><div className="text-white text-sm font-bold">{userRole === 'admin' ? 'Yönetici' : 'Satış Personeli'}</div><div className="text-slate-400 text-xs">Odoo Bağlantısı Aktif</div></div></div><nav className="mt-2 flex-1 px-2 space-y-1">{menuItems.map((item) => (<button key={item.id} onClick={() => { setActiveTab(item.id); setSelectedOrder(null); setFilterStatus('all'); setSearchTerm(''); setQuickCart([]); setQuickOfferDetails(null); setSelectedCustomer(null); }} className={`${activeTab === item.id ? 'bg-slate-800 text-white border-l-4 border-indigo-500' : 'text-slate-300 hover:bg-slate-800 hover:text-white'} group flex w-full items-center px-2 py-3 text-sm font-medium rounded-r-md transition-all`}><item.icon className={`${activeTab === item.id ? 'text-indigo-400' : 'text-slate-400 group-hover:text-slate-300'} mr-3 flex-shrink-0 h-5 w-5`} />{item.name}</button>))}</nav></div><div className="flex-shrink-0 flex bg-slate-800 p-4"><button onClick={()=>{setIsConnected(false);handleLogout()}} className="text-xs font-medium text-slate-300 hover:text-white flex items-center"><LogOut className="h-3 w-3 mr-1" /> Çıkış Yap</button></div></div></div></div>
      <div className="flex-1 overflow-auto focus:outline-none">
        <main className="flex-1 relative pb-8 z-0 overflow-y-auto">
          <div className="bg-white shadow px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center sticky top-0 z-10"><h1 className="text-2xl font-bold text-slate-900">{activeTab === 'dashboard' ? 'Genel Bakış' : activeTab === 'sales' ? 'Satış Yönetimi' : activeTab === 'customers' ? 'Müşteri İlişkileri' : activeTab === 'accounting' ? 'Muhasebe' : activeTab === 'products' ? 'Ürün Kataloğu' : activeTab === 'helpdesk' ? 'Teknik Servis' : activeTab === 'quick_offer' ? 'Hızlı Teklif' : 'Geliştirici'}</h1><div className="flex items-center space-x-4"><span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"><span className="w-2 h-2 bg-green-500 rounded-full mr-1.5"></span>Odoo Bağlı</span></div></div>
          <div className="mt-8 px-4 sm:px-6 lg:px-8">
            {activeTab === 'dashboard' && (<div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">{userRole === 'admin' ? (<div className="bg-white overflow-hidden shadow rounded-lg p-5"><div className="flex items-center"><div className="flex-shrink-0"><DollarSign className="h-6 w-6 text-slate-400" /></div><div className="ml-5 w-0 flex-1"><dt className="text-sm font-medium text-slate-500 truncate">Toplam Ciro</dt><dd className="text-lg font-medium text-slate-900">{formatCurrency(data.salesStats.totalRevenue)}</dd></div></div></div>) : null}<div className="bg-white overflow-hidden shadow rounded-lg p-5"><div className="flex items-center"><div className="flex-shrink-0"><FileText className="h-6 w-6 text-slate-400" /></div><div className="ml-5 w-0 flex-1"><dt className="text-sm font-medium text-slate-500 truncate">Aktif Teklifler</dt><dd className="text-lg font-medium text-slate-900">{data.salesStats.activeQuotations}</dd></div></div></div><div className="bg-white overflow-hidden shadow rounded-lg p-5"><div className="flex items-center"><div className="flex-shrink-0"><Package className="h-6 w-6 text-slate-400" /></div><div className="ml-5 w-0 flex-1"><dt className="text-sm font-medium text-slate-500 truncate">Onaylı Siparişler</dt><dd className="text-lg font-medium text-slate-900">{data.salesStats.confirmedOrders}</dd></div></div></div></div>)}
            {activeTab === 'quick_offer' && renderQuickOfferFull()}
            {activeTab === 'helpdesk' && renderHelpdesk()}
            {activeTab === 'sales' && userRole === 'admin' && renderSales()}
            {activeTab === 'products' && renderProducts()}
            {activeTab === 'accounting' && userRole === 'admin' && renderAccounting()}
            {activeTab === 'customers' && userRole === 'admin' && renderCustomers()}
            {activeTab === 'code' && userRole === 'admin' && <div className="bg-slate-900 text-green-400 p-4 rounded font-mono text-xs">Python integration code here...</div>}
          </div>
        </main>
      </div>
    </div>
  );
}
